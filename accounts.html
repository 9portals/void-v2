<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Accounts - VOID</title>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js"></script>
  <style>
    body {
      margin: 0;
      background-color: black;
      color: white;
      font-family: sans-serif;
      text-align: center;
    }
    header {
      padding: 10px;
      border-bottom: 1px solid #444;
    }
    nav a {
      margin: 0 10px;
      color: white;
      text-decoration: none;
    }
    .profile-container {
      margin-top: 30px;
    }
    .profile-pic {
      width: 120px;
      height: 120px;
      border-radius: 50%;
      object-fit: cover;
      border: 2px solid white;
    }
  </style>
</head>
<body>
  <header>
    <h1>VOID</h1>
    <nav>
      <a href="index.html">Home</a>
      <a href="view-profiles.html">View Profiles</a>
      <a href="chat.html">Global Chat</a>
      <a href="echoes.html">Echoes</a>
      <a href="edit-profile.html">Edit Profile</a>
      <a href="#" id="auth-link">Login</a>
    </nav>
  </header>

  <div class="profile-container">
    <h2>Your Account</h2>
    <img id="profile-pic" class="profile-pic" src="default.jpg" alt="Profile Picture"><br><br>
    <input type="file" id="image-upload"><br><br>
    <div id="profile-info"></div>
  </div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyD...",
      authDomain: "void-d9ec4.firebaseapp.com",
      projectId: "void-d9ec4",
      storageBucket: "void-d9ec4.appspot.com",
      messagingSenderId: "267268035851",
      appId: "1:267268035851:web:d535fe4175c06f170f3e0e",
      databaseURL: "https://void-d9ec4-default-rtdb.firebaseio.com"
    };
    firebase.initializeApp(firebaseConfig);

    const auth = firebase.auth();
    const db = firebase.database();
    const storage = firebase.storage();

    const profilePic = document.getElementById('profile-pic');
    const imageUpload = document.getElementById('image-upload');
    const profileInfo = document.getElementById('profile-info');
    const authLink = document.getElementById('auth-link');

    auth.onAuthStateChanged(user => {
      if (user) {
        authLink.textContent = 'Logout';
        authLink.onclick = () => auth.signOut();

        const uid = user.uid;
        const userRef = db.ref('users/' + uid);
        userRef.once('value').then(snapshot => {
          const data = snapshot.val();
          if (data && data.profilePicURL) {
            profilePic.src = data.profilePicURL;
          }
          profileInfo.innerHTML = `
            <p><strong>Username:</strong> ${data.username || 'N/A'}</p>
            <p><strong>Name:</strong> ${data.name || 'N/A'}</p>
            <p><strong>Age:</strong> ${data.age || 'N/A'}</p>
            <p><strong>Gender:</strong> ${data.gender || 'N/A'}</p>
            <p><strong>Bio:</strong> ${data.bio || 'N/A'}</p>
          `;
        });

        imageUpload.addEventListener('change', e => {
          const file = e.target.files[0];
          if (!file) return;
          const storageRef = storage.ref('profile_pictures/' + uid);
          storageRef.put(file).then(snapshot => {
            return snapshot.ref.getDownloadURL();
          }).then(url => {
            userRef.update({ profilePicURL: url });
            profilePic.src = url;
            alert('Profile picture updated!');
          }).catch(err => {
            console.error(err);
            alert('Failed to upload image.');
          });
        });

      } else {
        authLink.textContent = 'Login';
        authLink.href = 'login.html';
        profileInfo.innerHTML = '<p>Please log in to view your account.</p>';
        imageUpload.style.display = 'none';
      }
    });
  </script>
</body>
</html>
