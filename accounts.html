<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Edit Profile</title>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>
  <link rel="stylesheet" href="style.css" />
</head>
<body style="background:black; color:white; font-family:sans-serif;">
  <header style="padding: 10px; text-align: center;">
    <div style="font-size: 24px; font-weight: bold;">VOID</div>
    <nav style="margin-top: 10px;">
      <a href="index.html" style="margin: 0 10px;">Home</a>
      <a href="view-profiles.html" style="margin: 0 10px;">View Profiles</a>
      <a href="chat.html" style="margin: 0 10px;">Global Chat</a>
      <a id="editProfileBtn" href="edit-profile.html" style="margin: 0 10px;">Edit Profile</a>
      <button id="logoutBtn" style="margin: 0 10px;">Logout</button>
    </nav>
  </header>

  <main style="max-width: 600px; margin: 40px auto; text-align: center;">
    <h2>Your Profile</h2>
    <div id="profileView">
      <img id="profilePicView" src="" alt="Profile Picture" style="width:100px;height:100px;border-radius:50%;"><br>
      <p><strong>Name:</strong> <span id="nameView"></span></p>
      <p><strong>Age:</strong> <span id="ageView"></span></p>
      <p><strong>Gender:</strong> <span id="genderView"></span></p>
      <p><strong>Bio:</strong> <span id="bioView"></span></p>
    </div>

    <div id="profileEdit" style="display:none;">
      <input type="text" id="nameInput" placeholder="Name" /><br><br>
      <input type="number" id="ageInput" placeholder="Age" /><br><br>
      <input type="text" id="genderInput" placeholder="Gender" /><br><br>
      <textarea id="bioInput" placeholder="Bio"></textarea><br><br>
      <input type="text" id="picUrlInput" placeholder="Profile Picture URL" /><br><br>
      <button id="saveBtn">Save Profile</button>
    </div>

    <button id="editModeBtn">Edit</button>
  </main>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyBWyVO_0H92Yv99co5AbQawfA3vKjM30cY",
      authDomain: "void-d9ec4.firebaseapp.com",
      databaseURL: "https://void-d9ec4-default-rtdb.firebaseio.com",
      projectId: "void-d9ec4",
      storageBucket: "void-d9ec4.appspot.com",
      messagingSenderId: "267268035851",
      appId: "1:267268035851:web:d535fe4175c06f170f3e0e"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.database();

    const nameView = document.getElementById("nameView");
    const ageView = document.getElementById("ageView");
    const genderView = document.getElementById("genderView");
    const bioView = document.getElementById("bioView");
    const profilePicView = document.getElementById("profilePicView");

    const nameInput = document.getElementById("nameInput");
    const ageInput = document.getElementById("ageInput");
    const genderInput = document.getElementById("genderInput");
    const bioInput = document.getElementById("bioInput");
    const picUrlInput = document.getElementById("picUrlInput");

    const profileView = document.getElementById("profileView");
    const profileEdit = document.getElementById("profileEdit");
    const saveBtn = document.getElementById("saveBtn");
    const editModeBtn = document.getElementById("editModeBtn");
    const logoutBtn = document.getElementById("logoutBtn");

    let currentUserId = null;

    auth.onAuthStateChanged(user => {
      if (user) {
        currentUserId = user.uid;
        loadProfile(currentUserId);
      } else {
        window.location.href = "login.html";
      }
    });

    function loadProfile(uid) {
      db.ref("users/" + uid).once("value").then(snapshot => {
        const data = snapshot.val() || {};
        nameView.textContent = data.name || '';
        ageView.textContent = data.age || '';
        genderView.textContent = data.gender || '';
        bioView.textContent = data.bio || '';
        profilePicView.src = data.profilePicture || 'https://via.placeholder.com/100';

        // Populate edit inputs
        nameInput.value = data.name || '';
        ageInput.value = data.age || '';
        genderInput.value = data.gender || '';
        bioInput.value = data.bio || '';
        picUrlInput.value = data.profilePicture || '';

        setEditMode(false);
      });
    }

    saveBtn.onclick = () => {
      const name = nameInput.value.trim();
      const age = ageInput.value.trim();
      const gender = genderInput.value.trim();
      const bio = bioInput.value.trim();
      const profilePicture = picUrlInput.value.trim();

      db.ref("users/" + currentUserId).update({
        name, age, gender, bio, profilePicture
      }).then(() => {
        loadProfile(currentUserId);
      });
    };

    editModeBtn.onclick = () => {
      setEditMode(true);
    };

    logoutBtn.onclick = () => {
      auth.signOut().then(() => {
        window.location.href = "index.html";
      });
    };

    function setEditMode(isEdit) {
      profileView.style.display = isEdit ? "none" : "block";
      profileEdit.style.display = isEdit ? "block" : "none";
      editModeBtn.style.display = isEdit ? "none" : "inline-block";
    }
  </script>
</body>
</html>
