<!DOCTYPE html>
<html>
<head>
  <title>Test Upload</title>
  <script src="https://www.gstatic.com/firebasejs/10.10.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.10.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.10.0/firebase-storage-compat.js"></script>
</head>
<body style="background:black;color:white;text-align:center;">
  <h2>Upload Profile Picture</h2>
  <input type="file" id="fileInput" accept="image/*" />
  <button id="uploadBtn" disabled>Upload Image</button>
  <br><br>
  <img id="preview" src="#" style="display:none;width:100px;height:100px;border-radius:50%;" />

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyD1YgjFsxh-xZfeHlrxt_0igmH6SBIMcuc",
      authDomain: "void-d9ec4.firebaseapp.com",
      projectId: "void-d9ec4",
      storageBucket: "void-d9ec4.appspot.com",
      appId: "1:267268035851:web:d535fe4175c06f170f3e0e"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const storage = firebase.storage();

    const uploadBtn = document.getElementById("uploadBtn");
    const fileInput = document.getElementById("fileInput");

    // Enable upload only after auth confirms user
    let currentUser = null;
    auth.onAuthStateChanged(user => {
      if (user) {
        currentUser = user;
        uploadBtn.disabled = false;
        console.log("Logged in as:", user.uid);
      } else {
        alert("Not logged in. Upload won't work.");
      }
    });

    uploadBtn.addEventListener("click", () => {
      const file = fileInput.files[0];
      if (!file || !currentUser) {
        alert("No file or user.");
        return;
      }

      const ref = storage.ref("profilePics/" + currentUser.uid);
      ref.put(file).then(() => ref.getDownloadURL()).then(url => {
        document.getElementById("preview").src = url;
        document.getElementById("preview").style.display = "block";
        console.log("Success! File URL:", url);
      }).catch(error => {
        console.error("Upload failed:", error);
        alert("Upload error: " + error.message);
      });
    });
  </script>
</body>
</html>
