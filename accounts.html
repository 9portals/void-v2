<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Void | Account</title>
  <style>
    body {
      background-color: black;
      color: white;
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      text-align: center;
    }

    header {
      background-color: #111;
      padding: 1rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    header h1 {
      margin: 0;
      font-size: 24px;
      color: white;
    }

    nav {
      display: flex;
      gap: 1rem;
    }

    nav a, button.nav-btn {
      color: white;
      background: none;
      border: none;
      font-size: 16px;
      cursor: pointer;
      text-decoration: underline;
    }

    .container {
      padding: 2rem;
      max-width: 600px;
      margin: auto;
    }

    input, textarea {
      width: 100%;
      padding: 0.5rem;
      margin: 0.5rem 0;
      border-radius: 4px;
      border: 1px solid #444;
      background-color: #111;
      color: white;
    }

    .profile-pic {
      width: 100px;
      height: 100px;
      object-fit: cover;
      border-radius: 50%;
      margin-bottom: 1rem;
    }

    .hidden {
      display: none;
    }

    .btn {
      margin: 0.5rem;
      padding: 0.5rem 1rem;
      background-color: #222;
      border: none;
      color: white;
      cursor: pointer;
      border-radius: 4px;
    }

    .btn:hover {
      background-color: #333;
    }

    .stats {
      background: #111;
      padding: 1rem;
      border-radius: 8px;
      margin-top: 1rem;
      border: 1px solid #444;
    }
  </style>
</head>
<body>
  <header>
    <h1>VOID</h1>
    <nav>
      <a href="index.html">Home</a>
      <button class="nav-btn" id="editBtn">Edit Profile</button>
      <button class="nav-btn" id="logoutBtn">Logout</button>
    </nav>
  </header>

  <div class="container" id="authSection">
    <h2 id="authToggleTitle">Login</h2>
    <input type="email" id="email" placeholder="Email" />
    <input type="password" id="password" placeholder="Password" />
    <button class="btn" id="authActionBtn">Login</button>
    <p><a href="#" id="toggleAuth">Need to sign up?</a></p>
  </div>

  <div class="container hidden" id="profileSection">
    <img id="profilePic" class="profile-pic" src="" alt="Profile Picture"/>
    <input id="profilePicInput" placeholder="Profile Picture URL" class="hidden" />

    <input id="nameInput" placeholder="Name" disabled />
    <input id="ageInput" placeholder="Age" disabled />
    <input id="genderInput" placeholder="Gender" disabled />
    <textarea id="bioInput" placeholder="Bio" disabled></textarea>
    <input id="locationInput" placeholder="Location" disabled />
    <input id="interestsInput" placeholder="Interests" disabled />
    <input id="joinedInput" placeholder="Joined" disabled />

    <button class="btn hidden" id="saveProfileBtn">Save</button>

    <div class="stats">
      <p><strong>Status:</strong> Connected</p>
      <p><strong>Reputation:</strong> Mysterious</p>
      <p><strong>Posts:</strong> 0</p>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
    import { getDatabase, ref, set, get, update } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyD1YgjFsxh-xZfeHlrxt_0igmH6SBIMcuc",
      authDomain: "void-d9ec4.firebaseapp.com",
      databaseURL: "https://void-d9ec4-default-rtdb.firebaseio.com",
      projectId: "void-d9ec4",
      storageBucket: "void-d9ec4.appspot.com",
      messagingSenderId: "267268035851",
      appId: "1:267268035851:web:1e5ab79c51db42160f3e0e",
      measurementId: "G-ZYMQ3Z6LC5"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth();
    const db = getDatabase();

    const authSection = document.getElementById("authSection");
    const profileSection = document.getElementById("profileSection");
    const toggleAuth = document.getElementById("toggleAuth");
    const authActionBtn = document.getElementById("authActionBtn");
    const authToggleTitle = document.getElementById("authToggleTitle");

    const emailInput = document.getElementById("email");
    const passwordInput = document.getElementById("password");

    let isLogin = true;

    toggleAuth.addEventListener("click", () => {
      isLogin = !isLogin;
      authToggleTitle.innerText = isLogin ? "Login" : "Sign Up";
      authActionBtn.innerText = isLogin ? "Login" : "Sign Up";
      toggleAuth.innerText = isLogin ? "Need to sign up?" : "Already have an account?";
    });

    authActionBtn.addEventListener("click", async () => {
      const email = emailInput.value;
      const password = passwordInput.value;
      try {
        if (isLogin) {
          await signInWithEmailAndPassword(auth, email, password);
        } else {
          const userCred = await createUserWithEmailAndPassword(auth, email, password);
          const user = userCred.user;
          await set(ref(db, "users/" + user.uid), {
            email,
            name: "",
            age: "",
            gender: "",
            bio: "",
            location: "",
            interests: "",
            profilePic: "",
            joined: new Date().toLocaleDateString()
          });
        }
      } catch (error) {
        alert("Auth error: " + error.message);
      }
    });

    onAuthStateChanged(auth, async (user) => {
      if (user) {
        authSection.classList.add("hidden");
        profileSection.classList.remove("hidden");
        loadProfile(user.uid);
      } else {
        authSection.classList.remove("hidden");
        profileSection.classList.add("hidden");
      }
    });

    const profilePic = document.getElementById("profilePic");
    const profilePicInput = document.getElementById("profilePicInput");
    const nameInput = document.getElementById("nameInput");
    const ageInput = document.getElementById("ageInput");
    const genderInput = document.getElementById("genderInput");
    const bioInput = document.getElementById("bioInput");
    const locationInput = document.getElementById("locationInput");
    const interestsInput = document.getElementById("interestsInput");
    const joinedInput = document.getElementById("joinedInput");
    const saveProfileBtn = document.getElementById("saveProfileBtn");
    const editBtn = document.getElementById("editBtn");
    const logoutBtn = document.getElementById("logoutBtn");

    async function loadProfile(uid) {
      const snap = await get(ref(db, "users/" + uid));
      if (snap.exists()) {
        const data = snap.val();
        profilePic.src = data.profilePic || "";
        profilePicInput.value = data.profilePic || "";
        nameInput.value = data.name || "";
        ageInput.value = data.age || "";
        genderInput.value = data.gender || "";
        bioInput.value = data.bio || "";
        locationInput.value = data.location || "";
        interestsInput.value = data.interests || "";
        joinedInput.value = data.joined || "";
      }
    }

    editBtn.addEventListener("click", () => {
      [nameInput, ageInput, genderInput, bioInput, profilePicInput, locationInput, interestsInput].forEach(el => el.disabled = false);
      saveProfileBtn.classList.remove("hidden");
      profilePicInput.classList.remove("hidden");
    });

    saveProfileBtn.addEventListener("click", async () => {
      const user = auth.currentUser;
      if (!user) return;

      const updatedData = {
        name: nameInput.value,
        age: ageInput.value,
        gender: genderInput.value,
        bio: bioInput.value,
        location: locationInput.value,
        interests: interestsInput.value,
        profilePic: profilePicInput.value
      };

      await update(ref(db, "users/" + user.uid), updatedData);
      profilePic.src = profilePicInput.value;

      [nameInput, ageInput, genderInput, bioInput, profilePicInput, locationInput, interestsInput].forEach(el => el.disabled = true);
      profilePicInput.classList.add("hidden");
      saveProfileBtn.classList.add("hidden");
    });

    logoutBtn.addEventListener("click", () => signOut(auth));
  </script>
</body>
</html>
