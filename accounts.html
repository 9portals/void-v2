<!DOCTYPE html>
<html>
<head>
  <title>Firebase Upload Test</title>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-storage-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-database-compat.js"></script>
</head>
<body style="background:black; color:white; text-align:center; padding:40px;">

  <h2>Upload Profile Picture (TEMP RULES)</h2>
  <input type="file" id="fileInput" />
  <br><br>
  <button onclick="uploadImage()">Upload</button>
  <p id="status" style="white-space: pre-line; font-family: monospace;">Status: Ready</p>
  <img id="preview" src="" style="display:none; max-width:200px; margin-top:20px;" />

  <script>
    const status = document.getElementById('status');
    function updateStatus(msg) {
      console.log(msg);
      status.textContent = "Status: " + msg;
    }

    const firebaseConfig = {
      apiKey: "AIzaSyD1YgjFsxh-xZfeHlrxt_0igmH6SBIMcuc",
      authDomain: "void-d9ec4.firebaseapp.com",
      databaseURL: "https://void-d9ec4-default-rtdb.firebaseio.com",
      projectId: "void-d9ec4",
      storageBucket: "void-d9ec4.appspot.com",
      messagingSenderId: "267268035851",
      appId: "1:267268035851:web:d535fe4175c06f170f3e0e"
    };

    firebase.initializeApp(firebaseConfig);

    updateStatus("Initializing...");

    firebase.auth().signInWithEmailAndPassword('florisveen@gmail.com', '42884288')
      .then(userCredential => {
        updateStatus("Signed in as: " + userCredential.user.email);
      })
      .catch(error => {
        updateStatus("Login failed: " + error.message);
      });

    function uploadImage() {
      const file = document.getElementById('fileInput').files[0];
      if (!file) {
        updateStatus("No file selected.");
        return;
      }

      const user = firebase.auth().currentUser;
      if (!user) {
        updateStatus("User not signed in.");
        return;
      }

      updateStatus("Uploading...");

      const storageRef = firebase.storage().ref('profilePictures/' + user.uid + '.jpg');
      storageRef.put(file)
        .then(snapshot => {
          updateStatus("Upload complete. Getting download URL...");
          return snapshot.ref.getDownloadURL();
        })
        .then(downloadURL => {
          updateStatus("Success!\nURL: " + downloadURL);
          document.getElementById('preview').src = downloadURL;
          document.getElementById('preview').style.display = 'block';

          return firebase.database().ref('users/' + user.uid).update({
            profilePicture: downloadURL
          });
        })
        .catch(error => {
          updateStatus("Upload failed: " + error.message);
        });
    }
  </script>

</body>
</html>
