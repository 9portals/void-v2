<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>VOID - Account</title>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
  <style>
    body {
      background-color: black;
      color: white;
      font-family: monospace;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    header {
      background-color: #111;
      width: 100%;
      padding: 10px;
      text-align: center;
      font-size: 24px;
      border-bottom: 1px solid #333;
    }

    nav {
      margin: 10px;
    }

    nav button {
      background-color: black;
      color: white;
      border: 1px solid white;
      padding: 5px 10px;
      margin: 5px;
      cursor: pointer;
    }

    #form-container, #profile-container {
      border: 1px solid white;
      padding: 20px;
      margin-top: 20px;
      width: 90%;
      max-width: 500px;
    }

    input, textarea {
      width: 100%;
      margin-top: 5px;
      margin-bottom: 10px;
      background-color: #111;
      color: white;
      border: 1px solid white;
      padding: 8px;
    }

    img {
      max-width: 100px;
      border-radius: 50%;
      margin-top: 10px;
    }

    .hidden {
      display: none;
    }
  </style>
</head>
<body>
  <header>VOID</header>

  <nav>
    <button onclick="toggleForm()">Switch to Signup/Login</button>
    <button onclick="editProfile()" id="editBtn" class="hidden">Edit Profile</button>
    <button onclick="logout()" id="logoutBtn" class="hidden">Logout</button>
  </nav>

  <div id="form-container">
    <h2 id="formTitle">Login</h2>
    <input type="email" id="email" placeholder="Email">
    <input type="password" id="password" placeholder="Password">
    <input type="text" id="username" placeholder="Username (Sign Up only)" class="hidden">
    <button onclick="submitForm()">Submit</button>
  </div>

  <div id="profile-container" class="hidden">
    <h2 id="profileHeader">Your Profile</h2>
    <div id="view-mode">
      <img id="view-pic" src="" alt="Profile Pic"><br>
      <strong>Username:</strong> <span id="view-username"></span><br>
      <strong>Age:</strong> <span id="view-age"></span><br>
      <strong>Gender:</strong> <span id="view-gender"></span><br>
      <strong>Bio:</strong> <span id="view-bio"></span><br>
      <strong>Recent Visitors:</strong>
      <ul id="visitorList"></ul>
    </div>
    <div id="edit-mode" class="hidden">
      <input type="text" id="edit-age" placeholder="Age">
      <input type="text" id="edit-gender" placeholder="Gender">
      <textarea id="edit-bio" placeholder="Bio"></textarea>
      <input type="text" id="edit-pic" placeholder="Profile Picture URL">
      <button onclick="saveProfile()">Save</button>
    </div>
  </div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyD1YgjFsxh-xZfeHlrxt_0igmH6SBIMcuc",
      authDomain: "void-d9ec4.firebaseapp.com",
      databaseURL: "https://void-d9ec4-default-rtdb.firebaseio.com",
      projectId: "void-d9ec4",
      storageBucket: "void-d9ec4.appspot.com",
      messagingSenderId: "267268035851",
      appId: "1:267268035851:web:1e5ab79c51db42160f3e0e",
      measurementId: "G-ZYMQ3Z6LC5"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.database();

    let isLogin = true;

    function toggleForm() {
      isLogin = !isLogin;
      document.getElementById("formTitle").innerText = isLogin ? "Login" : "Sign Up";
      document.getElementById("username").classList.toggle("hidden", isLogin);
    }

    function submitForm() {
      const email = document.getElementById("email").value;
      const password = document.getElementById("password").value;
      const username = document.getElementById("username").value;

      if (isLogin) {
        auth.signInWithEmailAndPassword(email, password).then(() => {
          loadProfile();
        }).catch(alert);
      } else {
        auth.createUserWithEmailAndPassword(email, password).then(cred => {
          db.ref("users/" + cred.user.uid).set({
            username,
            age: "",
            gender: "",
            bio: "",
            pic: "",
            visitors: []
          }).then(() => loadProfile());
        }).catch(alert);
      }
    }

    function loadProfile() {
      document.getElementById("form-container").classList.add("hidden");
      document.getElementById("profile-container").classList.remove("hidden");
      document.getElementById("editBtn").classList.remove("hidden");
      document.getElementById("logoutBtn").classList.remove("hidden");

      const uid = auth.currentUser.uid;
      db.ref("users/" + uid).once("value").then(snapshot => {
        const data = snapshot.val();
        document.getElementById("view-username").innerText = data.username;
        document.getElementById("view-age").innerText = data.age;
        document.getElementById("view-gender").innerText = data.gender;
        document.getElementById("view-bio").innerText = data.bio;
        document.getElementById("view-pic").src = data.pic || "";

        const visitorList = document.getElementById("visitorList");
        visitorList.innerHTML = "";
        const visitors = data.visitors || [];
        visitors.slice(-5).reverse().forEach(v => {
          const li = document.createElement("li");
          li.innerText = v;
          visitorList.appendChild(li);
        });
      });
    }

    function editProfile() {
      document.getElementById("view-mode").classList.add("hidden");
      document.getElementById("edit-mode").classList.remove("hidden");

      const uid = auth.currentUser.uid;
      db.ref("users/" + uid).once("value").then(snapshot => {
        const data = snapshot.val();
        document.getElementById("edit-age").value = data.age || "";
        document.getElementById("edit-gender").value = data.gender || "";
        document.getElementById("edit-bio").value = data.bio || "";
        document.getElementById("edit-pic").value = data.pic || "";
      });
    }

    function saveProfile() {
      const uid = auth.currentUser.uid;
      const updates = {
        age: document.getElementById("edit-age").value,
        gender: document.getElementById("edit-gender").value,
        bio: document.getElementById("edit-bio").value,
        pic: document.getElementById("edit-pic").value
      };
      db.ref("users/" + uid).update(updates).then(() => {
        document.getElementById("edit-mode").classList.add("hidden");
        document.getElementById("view-mode").classList.remove("hidden");
        loadProfile();
      });
    }

    function logout() {
      auth.signOut().then(() => {
        location.reload();
      });
    }

    auth.onAuthStateChanged(user => {
      if (user) {
        loadProfile();
      }
    });
  </script>
</body>
</html>
