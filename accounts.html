<!DOCTYPE html>
<html>
<head>
  <title>Firebase Upload Test</title>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-storage-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-database-compat.js"></script>
</head>
<body style="background:black; color:white; text-align:center; padding:40px;">

  <h2>Upload Profile Picture</h2>
  <input type="file" id="fileInput" />
  <br><br>
  <button onclick="uploadImage()">Upload</button>
  <p id="status">Status: Ready</p>
  <img id="preview" src="" style="display:none; max-width:200px; margin-top:20px;" />

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyD1YgjFsxh-xZfeHlrxt_0igmH6SBIMcuc",
      authDomain: "void-d9ec4.firebaseapp.com",
      databaseURL: "https://void-d9ec4-default-rtdb.firebaseio.com",
      projectId: "void-d9ec4",
      storageBucket: "void-d9ec4.appspot.com",
      messagingSenderId: "267268035851",
      appId: "1:267268035851:web:d535fe4175c06f170f3e0e"
    };

    firebase.initializeApp(firebaseConfig);

    const status = document.getElementById('status');

    firebase.auth().signInWithEmailAndPassword('florisveen@gmail.com', '42884288')
      .then(userCredential => {
        status.textContent = "Signed in as: " + userCredential.user.email;
      })
      .catch(error => {
        status.textContent = "Login failed: " + error.message;
      });

    function uploadImage() {
      const file = document.getElementById('fileInput').files[0];
      if (!file) {
        status.textContent = "Please choose a file.";
        return;
      }

      const user = firebase.auth().currentUser;
      if (!user) {
        status.textContent = "User not signed in.";
        return;
      }

      status.textContent = "Uploading...";
      const storageRef = firebase.storage().ref('profilePictures/' + user.uid + '.jpg');

      storageRef.put(file).then(snapshot => {
        return snapshot.ref.getDownloadURL();
      }).then(downloadURL => {
        // Save the download URL in Realtime Database
        return firebase.database().ref('users/' + user.uid).update({
          profilePicture: downloadURL
        }).then(() => {
          status.textContent = "Upload successful!";
          const img = document.getElementById('preview');
          img.src = downloadURL;
          img.style.display = 'block';
        });
      }).catch(error => {
        status.textContent = "Upload failed: " + error.message;
      });
    }
  </script>

</body>
</html>
