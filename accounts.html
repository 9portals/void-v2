<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Accounts - VOID</title>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js"></script>
  <style>
    body {
      margin: 0;
      background-color: black;
      color: white;
      font-family: sans-serif;
      text-align: center;
    }
    header {
      padding: 10px;
      border-bottom: 1px solid #444;
    }
    nav a {
      margin: 0 10px;
      color: white;
      text-decoration: none;
    }
    .container {
      margin-top: 30px;
    }
    .profile-pic {
      width: 120px;
      height: 120px;
      border-radius: 50%;
      object-fit: cover;
      border: 2px solid white;
    }
    input, textarea {
      background: #111;
      color: white;
      border: 1px solid #444;
      padding: 5px;
      margin: 5px;
    }
    button {
      background: #222;
      color: white;
      padding: 6px 12px;
      border: 1px solid white;
      margin-top: 10px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <header>
    <h1>VOID</h1>
    <nav>
      <a href="index.html">Home</a>
      <a href="view-profiles.html">View Profiles</a>
      <a href="chat.html">Global Chat</a>
      <a href="echoes.html">Echoes</a>
    </nav>
  </header>

  <div class="container" id="auth-section">
    <h2>Sign Up / Log In</h2>
    <input type="email" id="email" placeholder="Email"><br>
    <input type="password" id="password" placeholder="Password"><br>
    <button onclick="signup()">Sign Up</button>
    <button onclick="login()">Log In</button>
  </div>

  <div class="container" id="profile-section" style="display:none;">
    <h2>Your Profile</h2>
    <img id="profile-pic" class="profile-pic" src="default.jpg" alt="Profile Picture"><br><br>
    <input type="file" id="image-upload"><br><br>
    <input type="text" id="username" placeholder="Username"><br>
    <input type="text" id="name" placeholder="Name"><br>
    <input type="number" id="age" placeholder="Age"><br>
    <input type="text" id="gender" placeholder="Gender"><br>
    <textarea id="bio" placeholder="Bio"></textarea><br>
    <button onclick="saveProfile()">Save Profile</button><br><br>
    <button onclick="logout()">Log Out</button>
  </div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyD...",
      authDomain: "void-d9ec4.firebaseapp.com",
      databaseURL: "https://void-d9ec4-default-rtdb.firebaseio.com",
      projectId: "void-d9ec4",
      storageBucket: "void-d9ec4.firebasestorage.googleapis.com",
      messagingSenderId: "267268035851",
      appId: "1:267268035851:web:d535fe4175c06f170f3e0e"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.database();
    const storage = firebase.storage();

    const authSection = document.getElementById('auth-section');
    const profileSection = document.getElementById('profile-section');

    auth.onAuthStateChanged(user => {
      if (user) {
        authSection.style.display = 'none';
        profileSection.style.display = 'block';

        const uid = user.uid;
        const userRef = db.ref('users/' + uid);

        userRef.once('value').then(snapshot => {
          const data = snapshot.val() || {};
          document.getElementById('username').value = data.username || '';
          document.getElementById('name').value = data.name || '';
          document.getElementById('age').value = data.age || '';
          document.getElementById('gender').value = data.gender || '';
          document.getElementById('bio').value = data.bio || '';
          if (data.profilePicURL) {
            document.getElementById('profile-pic').src = data.profilePicURL;
          }
        });

        document.getElementById('image-upload').addEventListener('change', e => {
          const file = e.target.files[0];
          if (!file) return;
          const storageRef = storage.ref('profile_pictures/' + uid);
          storageRef.put(file).then(snapshot => snapshot.ref.getDownloadURL()).then(url => {
            userRef.update({ profilePicURL: url });
            document.getElementById('profile-pic').src = url;
            alert('Profile picture updated!');
          });
        });

      } else {
        authSection.style.display = 'block';
        profileSection.style.display = 'none';
      }
    });

    function signup() {
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;
      auth.createUserWithEmailAndPassword(email, password)
        .then(() => alert('Signed up successfully. You are now logged in.'))
        .catch(error => alert(error.message));
    }

    function login() {
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;
      auth.signInWithEmailAndPassword(email, password)
        .then(() => alert('Logged in successfully.'))
        .catch(error => alert(error.message));
    }

    function logout() {
      auth.signOut().then(() => {
        alert("Logged out.");
        location.reload();
      });
    }

    function saveProfile() {
      const uid = auth.currentUser.uid;
      const userRef = db.ref('users/' + uid);
      const data = {
        username: document.getElementById('username').value,
        name: document.getElementById('name').value,
        age: document.getElementById('age').value,
        gender: document.getElementById('gender').value,
        bio: document.getElementById('bio').value
      };
      userRef.update(data).then(() => {
        alert('Profile saved!');
        window.location.href = 'view-profiles.html';
      });
    }
  </script>
</body>
</html>
